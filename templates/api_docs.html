<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - Hydepark Lyve Middleware</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        .endpoint-card {
            border-left: 4px solid;
            margin-bottom: 1.5rem;
        }
        .get { border-left-color: #28a745; }
        .post { border-left-color: #007bff; }
        .put { border-left-color: #ffc107; }
        .delete { border-left-color: #dc3545; }
        .badge-method {
            font-size: 0.8rem;
            min-width: 60px;
        }
        .code-block {
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .nav-pills .nav-link.active {
            background-color: #007bff;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-exchange-alt"></i> Hydepark Lyve Middleware
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="/test">
                    <i class="fas fa-flask"></i> Test UI
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card sticky-top">
                    <div class="card-header">
                        <h5 class="mb-0">API Documentation</h5>
                    </div>
                    <div class="card-body p-0">
                        <nav class="nav flex-column nav-pills p-2">
                            <a class="nav-link active" href="#overview" data-bs-toggle="pill">Overview</a>
                            <a class="nav-link" href="#authentication" data-bs-toggle="pill">Authentication</a>
                            <a class="nav-link" href="#endpoints" data-bs-toggle="pill">Endpoints</a>
                            <a class="nav-link" href="#health" data-bs-toggle="pill">Health Check</a>
                            <a class="nav-link" href="#person-check" data-bs-toggle="pill">Person Check</a>
                            <a class="nav-link" href="#person-create" data-bs-toggle="pill">Person Create</a>
                            <a class="nav-link" href="#person-update" data-bs-toggle="pill">Person Update</a>
                            <a class="nav-link" href="#person-delete" data-bs-toggle="pill">Person Delete</a>
                            <a class="nav-link" href="#person-search" data-bs-toggle="pill">Person Search</a>
                            <a class="nav-link" href="#batch-create" data-bs-toggle="pill">Batch Create</a>
                            <a class="nav-link" href="#face-validation" data-bs-toggle="pill">Face Validation</a>
                            <a class="nav-link" href="#config" data-bs-toggle="pill">Configuration</a>
                            <a class="nav-link" href="#errors" data-bs-toggle="pill">Error Handling</a>
                        </nav>
                    </div>
                </div>
            </div>

            <div class="col-md-9">
                <div class="tab-content">
                    <!-- Overview Tab -->
                    <div class="tab-pane fade show active" id="overview">
                        <div class="card">
                            <div class="card-body">
                                <h2>API Overview</h2>
                                <p class="lead">Hydepark Lyve Middleware provides a RESTful API for integrating Lyve Access Control with HikCentral Professional.</p>
                                
                                <h4>Base URL</h4>
                                <div class="code-block">
                                    <code>http://localhost:3000</code>
                                </div>

                                <h4>API Version</h4>
                                <p>Current version: <span class="badge bg-primary">v2.0</span></p>

                                <h4>Content Type</h4>
                                <p>All requests and responses use <code>application/json</code></p>

                                <h4>Authentication</h4>
                                <p>All API endpoints require authentication via <code>X-API-Key</code> header.</p>

                                <h4>Features</h4>
                                <ul>
                                    <li>Person CRUD operations</li>
                                    <li>Face image support</li>
                                    <li>Batch operations</li>
                                    <li>Advanced search</li>
                                    <li>Comprehensive logging</li>
                                    <li>Face validation</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Authentication Tab -->
                    <div class="tab-pane fade" id="authentication">
                        <div class="card">
                            <div class="card-body">
                                <h2>Authentication</h2>
                                <p>All API endpoints require authentication using an API key.</p>

                                <h4>API Key Header</h4>
                                <div class="code-block">
                                    <strong>X-API-Key:</strong> your-api-key-here
                                </div>

                                <h4>Example Request</h4>
                                <div class="code-block">
                                    <pre><code>curl -X POST http://localhost:3000/api/person/check \
  -H "Content-Type: application/json" \
  -H "X-API-Key: demo-key" \
  -d '{"personId": "test_person_123"}'</code></pre>
                                </div>

                                <h4>Configuration</h4>
                                <p>Set your API key in the environment variable:</p>
                                <div class="code-block">
                                    <code>LYVE_API_KEY=your-secure-api-key</code>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Endpoints Tab -->
                    <div class="tab-pane fade" id="endpoints">
                        <div class="card">
                            <div class="card-body">
                                <h2>API Endpoints</h2>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Method</th>
                                                <th>Endpoint</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge bg-success">GET</span></td>
                                                <td><code>/health</code></td>
                                                <td>System health check</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">GET</span></td>
                                                <td><code>/api/config</code></td>
                                                <td>Get configuration settings</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">POST</span></td>
                                                <td><code>/api/person/check</code></td>
                                                <td>Check person existence</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">POST</span></td>
                                                <td><code>/api/person/create</code></td>
                                                <td>Create new person</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-warning">PUT</span></td>
                                                <td><code>/api/person/update</code></td>
                                                <td>Update person</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">DELETE</span></td>
                                                <td><code>/api/person/delete</code></td>
                                                <td>Delete person</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">POST</span></td>
                                                <td><code>/api/person/search</code></td>
                                                <td>Search persons</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-info">POST</span></td>
                                                <td><code>/api/person/batch/create</code></td>
                                                <td>Batch create persons</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-primary">POST</span></td>
                                                <td><code>/api/face/validate</code></td>
                                                <td>Validate face image</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Health Check Tab -->
                    <div class="tab-pane fade" id="health">
                        <div class="card endpoint-card get">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Health Check</h3>
                                    <span class="badge badge-method bg-success">GET</span>
                                </div>
                                <p>Check system health and connectivity status.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <code>GET /health</code>
                                </div>

                                <h5>Response (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "status": "healthy",
  "database": "healthy",
  "timestamp": "2024-01-01T12:00:00.000000",
  "version": "2.0.0"
}</code></pre>
                                </div>

                                <h5>cURL Example</h5>
                                <div class="code-block">
                                    <pre><code>curl -X GET http://localhost:3000/health</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Person Check Tab -->
                    <div class="tab-pane fade" id="person-check">
                        <div class="card endpoint-card post">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Check Person</h3>
                                    <span class="badge badge-method bg-primary">POST</span>
                                </div>
                                <p>Check if a person exists in the local database and get their HikCentral mapping.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>POST /api/person/check
Content-Type: application/json
X-API-Key: demo-key

{
  "personId": "lyve_person_123"
}</code></pre>
                                </div>

                                <h5>Response - Person Found (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "exists": true,
  "hikcentralId": "hikcentral_456",
  "personData": {
    "id": 1,
    "lyve_person_id": "lyve_person_123",
    "hikcentral_person_id": "hikcentral_456",
    "name": "John Doe",
    "phone": "1234567890",
    "email": "john@example.com",
    "gender": 1,
    "face_count": 2,
    "created_at": "2024-01-01T00:00:00",
    "updated_at": "2024-01-01T00:00:00"
  }
}</code></pre>
                                </div>

                                <h5>Response - Person Not Found (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "exists": false,
  "message": "Person not found in local database"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Person Create Tab -->
                    <div class="tab-pane fade" id="person-create">
                        <div class="card endpoint-card post">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Create Person</h3>
                                    <span class="badge badge-method bg-success">POST</span>
                                </div>
                                <p>Create a new person in HikCentral and store the mapping in the local database.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>POST /api/person/create
Content-Type: application/json
X-API-Key: demo-key

{
  "personId": "lyve_person_123",
  "name": "John Doe",
  "givenName": "John",
  "phone": "1234567890",
  "email": "john@example.com",
  "gender": 1,
  "faceImages": ["base64_encoded_face_image"],
  "certificateType": 111,
  "certificateNum": "123456789012345",
  "personType": 1,
  "beginTime": "2024-01-01T00:00:00",
  "endTime": "2030-01-01T00:00:00"
}</code></pre>
                                </div>

                                <h5>Response - Success (201 Created)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "hikcentralId": "hikcentral_456",
  "message": "Person created successfully",
  "faceCount": 1
}</code></pre>
                                </div>

                                <h5>Response - Person Exists (409 Conflict)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "error": "Person already exists",
  "hikcentralId": "hikcentral_456"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Person Update Tab -->
                    <div class="tab-pane fade" id="person-update">
                        <div class="card endpoint-card put">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Update Person</h3>
                                    <span class="badge badge-method bg-warning">PUT</span>
                                </div>
                                <p>Update an existing person's information in both HikCentral and local database.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>PUT /api/person/update
Content-Type: application/json
X-API-Key: demo-key

{
  "personId": "lyve_person_123",
  "name": "John Updated Doe",
  "phone": "0987654321",
  "email": "john.updated@example.com",
  "faceImages": ["updated_base64_face_image"]
}</code></pre>
                                </div>

                                <h5>Response - Success (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "message": "Person updated successfully",
  "faceCount": 1
}</code></pre>
                                </div>

                                <h5>Response - Person Not Found (404 Not Found)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "error": "Person not found"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Person Delete Tab -->
                    <div class="tab-pane fade" id="person-delete">
                        <div class="card endpoint-card delete">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Delete Person</h3>
                                    <span class="badge badge-method bg-danger">DELETE</span>
                                </div>
                                <p>Delete a person from both HikCentral and local database.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>DELETE /api/person/delete
Content-Type: application/json
X-API-Key: demo-key

{
  "personId": "lyve_person_123"
}</code></pre>
                                </div>

                                <h5>Response - Success (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "message": "Person deleted successfully"
}</code></pre>
                                </div>

                                <h5>Response - Person Not Found (404 Not Found)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "error": "Person not found"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Person Search Tab -->
                    <div class="tab-pane fade" id="person-search">
                        <div class="card endpoint-card post">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Search Persons</h3>
                                    <span class="badge badge-method bg-primary">POST</span>
                                </div>
                                <p>Search for persons with various criteria and pagination support.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>POST /api/person/search
Content-Type: application/json
X-API-Key: demo-key

{
  "name": "John",
  "phone": "123",
  "email": "john@",
  "gender": 1,
  "orgIndexCode": "1",
  "limit": 50,
  "offset": 0
}</code></pre>
                                </div>

                                <h5>Response (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "total": 15,
  "count": 2,
  "limit": 50,
  "offset": 0,
  "persons": [
    {
      "id": 1,
      "lyve_person_id": "lyve_person_123",
      "hikcentral_person_id": "hikcentral_456",
      "name": "John Doe",
      "phone": "1234567890",
      "email": "john@example.com",
      "gender": 1,
      "face_count": 2,
      "created_at": "2024-01-01T00:00:00",
      "updated_at": "2024-01-01T00:00:00"
    }
  ]
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Batch Create Tab -->
                    <div class="tab-pane fade" id="batch-create">
                        <div class="card endpoint-card post">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Batch Create Persons</h3>
                                    <span class="badge badge-method bg-info">POST</span>
                                </div>
                                <p>Create multiple persons in a single request (maximum 100 persons per batch).</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>POST /api/person/batch/create
Content-Type: application/json
X-API-Key: demo-key

{
  "persons": [
    {
      "personId": "lyve_person_1",
      "name": "Person 1",
      "phone": "1111111111",
      "email": "person1@example.com",
      "gender": 1,
      "faceImages": ["base64_face_image"]
    },
    {
      "personId": "lyve_person_2",
      "name": "Person 2",
      "phone": "2222222222",
      "email": "person2@example.com",
      "gender": 2,
      "faceImages": ["base64_face_image"]
    }
  ]
}</code></pre>
                                </div>

                                <h5>Response (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "total": 2,
  "successCount": 2,
  "errorCount": 0,
  "results": [
    {
      "index": 0,
      "personId": "lyve_person_1",
      "success": true,
      "message": "Person created successfully",
      "hikcentral_id": "hikcentral_789"
    },
    {
      "index": 1,
      "personId": "lyve_person_2",
      "success": true,
      "message": "Person created successfully",
      "hikcentral_id": "hikcentral_790"
    }
  ]
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Face Validation Tab -->
                    <div class="tab-pane fade" id="face-validation">
                        <div class="card endpoint-card post">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Face Validation</h3>
                                    <span class="badge badge-method bg-primary">POST</span>
                                </div>
                                <p>Validate face image data before person creation.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>POST /api/face/validate
Content-Type: application/json
X-API-Key: demo-key

{
  "faceImage": "base64_encoded_face_image"
}</code></pre>
                                </div>

                                <h5>Response - Valid (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "valid": true,
  "qualityScore": 85,
  "faceInfo": {
    "size_chars": 24576,
    "format": "JPEG",
    "dimensions": "800x600",
    "mode": "RGB",
    "quality_score": 85
  },
  "message": "Face image is valid"
}</code></pre>
                                </div>

                                <h5>Response - Invalid (400 Bad Request)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "success": true,
  "valid": false,
  "message": "Face image validation failed"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Tab -->
                    <div class="tab-pane fade" id="config">
                        <div class="card endpoint-card get">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h3>Configuration</h3>
                                    <span class="badge badge-method bg-success">GET</span>
                                </div>
                                <p>Get current system configuration settings.</p>

                                <h5>Request</h5>
                                <div class="code-block">
                                    <pre><code>GET /api/config
X-API-Key: demo-key</code></pre>
                                </div>

                                <h5>Response (200 OK)</h5>
                                <div class="code-block">
                                    <pre><code>{
  "hikcentral": {
    "base_url": "https://your-hikcentral-server/artemis",
    "verify_ssl": true,
    "org_index_code": "1"
  },
  "api": {
    "timeout": 30,
    "max_retries": 3,
    "max_content_length": 16777216,
    "max_batch_size": 100
  },
  "face_validation": {
    "supported_formats": ["JPEG", "JPG", "PNG", "BMP"],
    "max_size_bytes": 2097152,
    "recommended_size": [800, 600],
    "min_face_size": [100, 100],
    "max_face_images": 5
  },
  "authentication": {
    "require_api_key": true
  }
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Error Handling Tab -->
                    <div class="tab-pane fade" id="errors">
                        <div class="card">
                            <div class="card-body">
                                <h2>Error Handling</h2>
                                <p>The API uses standard HTTP status codes and returns consistent error responses.</p>

                                <h4>Error Response Format</h4>
                                <div class="code-block">
                                    <pre><code>{
  "error": "Error description",
  "message": "Detailed error information"
}</code></pre>
                                </div>

                                <h4>HTTP Status Codes</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped">
                                        <thead>
                                            <tr>
                                                <th>Status Code</th>
                                                <th>Description</th>
                                                <th>Common Causes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><span class="badge bg-success">200</span></td>
                                                <td>Success</td>
                                                <td>Request processed successfully</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-success">201</span></td>
                                                <td>Created</td>
                                                <td>Resource created successfully</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-warning">400</span></td>
                                                <td>Bad Request</td>
                                                <td>Invalid request data, missing fields</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">401</span></td>
                                                <td>Unauthorized</td>
                                                <td>Missing or invalid API key</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">404</span></td>
                                                <td>Not Found</td>
                                                <td>Resource not found</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-warning">409</span></td>
                                                <td>Conflict</td>
                                                <td>Resource already exists</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">413</span></td>
                                                <td>Payload Too Large</td>
                                                <td>Request payload exceeds limit</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">429</span></td>
                                                <td>Too Many Requests</td>
                                                <td>Rate limit exceeded</td>
                                            </tr>
                                            <tr>
                                                <td><span class="badge bg-danger">500</span></td>
                                                <td>Internal Server Error</td>
                                                <td>Server error, check logs</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <h4>Common Error Examples</h4>
                                <div class="code-block">
                                    <pre><code>// Missing API key
{
  "error": "API key required"
}

// Invalid API key
{
  "error": "Invalid API key"
}

// Missing required field
{
  "error": "Missing required fields: personId"
}

// Person not found
{
  "error": "Person not found"
}

// Internal server error
{
  "error": "Internal server error"
}</code></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.0/plugins/autoloader/prism-autoloader.min.js"></script>
</body>
</html>